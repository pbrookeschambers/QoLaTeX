\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{qomath}[2021/11/21 Easy math formatting for LaTeX]

\RequirePackage{amsmath}
\RequirePackage{amssymb}

\let\thorn\th						%renaming a command that would otherwise be replaced

% Dimensions
\newdimen\mheight
\newdimen\lheight
\newdimen\rheight

\newcommand{\uvec}[1]{\hat{x}}			%unit vector in the style of the normal \vec command

%\renewcommand{\vec}[1]{\mathbf{#1}}		%bold style \vec and \uvec commands to be implemented as an option with the package later
%\newcommand{\uvec}[1]{\mathbf{\hat{{#1}}}}

\newcommand{\diverge}{\nabla\cdot}			%common uses of the nabla sybol
\newcommand{\curl}{\nabla\times}
\newcommand{\laplace}{\nabla^2}

\newcommand{\real}{\mathbb{R}}			%number sets notation
\newcommand{\complex}{\mathbb{C}}
\newcommand{\integer}{\mathbb{Z}}
\newcommand{\nat}{\mathbb{N}}				%\natural conflicts with an existing LaTeX symbol
\newcommand{\rational}{\mathbb{Q}}
\newcommand{\irrational}{\mathbb{I}}

\newcommand{\inver}[1]{\frac{1}{{#1}}}								%derivatives, partial derivatives and reciprocals (oh my!)
\newcommand{\deriv}[3][]{\frac{\text{d}^{#1}{#2}}{\text{d}{#3}^{#1}}}
\newcommand{\dderiv}[3]{\frac{\text{d}^2{#1}}{\text{d}{#2}\,\text{d}{#3}}}
\newcommand{\pderiv}[3][]{\frac{\partial^{#1}{#2}}{\partial{#3}^{#1}}}
\newcommand{\ppderiv}[3]{\frac{\partial^2 {#1}}{\partial {#2}\,\partial {#3}}}

\newcommand{\lrbracket}[1]{\mathopen{}\left({#1}\right)}	%[l]eft-[r]ight [bracket]s
\newcommand{\lrsquare}[1]{\mathopen{}\left[{#1}\right]}	%^^
\newcommand{\lrbrace}[1]{\mathopen{}\left\{{#1}\right\}}	%^^
\newcommand{\lrangle}[1]{\mathopen{}\left<{#1}\right>}	%^^
\newcommand{\lrpipe}[1]{\mathopen{}\left|{#1}\right|}	%^^
\newcommand{\rlangle}[1]{\mathopen{}\left>{#1}\right<}	%inward pointing version of \lrangle

\newcommand{\ullimit}[2]{^{^{#2}}_{_{#1}}}	%Integrals, [u]pper-[l]ower [limit]s (from 1st argument to 2nd argument)
\newcommand{\limint}[2]{\int\ullimit{#1}{#2}}
\newcommand{\fullint}[4]{\limint{#1}{#2}\!{#3}\,\text{d}{#4}}

\newcommand{\bra}[1]{\mathopen{}\left<\mathopen{}\left.\!{#1}\right|\right.\!}		%bra and ket
\newcommand{\ket}[1]{\mathopen{}\left.\!\mathopen{}\left|{#1}\right.\!\right>}

\newcommand{\braket}[3][\@nil]{		%braket, scaling to the larger of the arguments, with a third optional argument for the inner operator.
	\setbox0=\hbox{\ensuremath{#2}}
	\lheight=\ht0
	\advance\lheight by \dp0
	\setbox0=\hbox{\ensuremath{#3}}
	\rheight=\ht0
	\advance\rheight by \dp0
  \def\tmp{#1}%
  \ifx\tmp\@nnil
    % No optional argument was passed, proceed with <a|b>
  	\ifdim\lheight>\rheight
      % Using \mathopen and \mathclose and \mspace to redistribute spacing "correctly" around mismatched brackets
  		\ensuremath{\mathopen{}\left\langle\mathopen{}\left.{#2}\mspace{1.75mu}\right|\mathclose{}\mspace{1.75mu}{#3}\mspace{1.75mu}\right\rangle\mathclose{}}
  	\else
  		\ensuremath{\mathopen{}\left\langle\mspace{1.75mu}{#2}\mspace{1.75mu}\mathopen{}\left|\mspace{1.75mu}{#3}\right.\mathclose{}\right\rangle\mathclose{}}
  	\fi
  \else
    % Optional argument was passed, proceed with <a|H|b>
    % We need the middle height too
  	\setbox0=\hbox{\ensuremath{#1}}
  	\mheight=\ht0
  	\advance\mheight by \dp0
    \ifdim\lheight>\mheight
      \ifdim\lheight>\rheight
        % Left is tallest
      \ensuremath{\mathopen{}\left\langle \mathopen{}\left. \mathopen{}\left. #2 \right|\mathclose{} #1 \right|\mathclose{} #3 \mspace{1.75mu}\right\rangle\mathclose{}}
      \else
        % Right is tallest
        \ensuremath{\mathopen{}\left\langle \mspace{1.75mu} #2 \mathopen{}\left| #1 \mathopen{}\left| #3 \right.\mathclose{} \right.\mathclose{}} \right\rangle\mathclose{}
      \fi
    \else
      \ifdim\mheight>\rheight
        % Middle is tallest
        \ensuremath{\mathopen{}\left\langle \mspace{1.75mu} #2 \mathopen{}\left|\mathopen{}\left. #1 \right|\mathclose{}\right.\mathclose{} #3 \right\rangle\mathclose{}}
      \else
        % Right is tallest
        \ensuremath{\mathopen{}\left\langle \mspace{1.75mu} #2 \mathopen{}\left| #1 \mathopen{}\left| #3 \right.\mathclose{} \right.\mathclose{}} \right\rangle\mathclose{}
      \fi
    \fi
  \fi
}

\newcommand{\ketbra}[3][\@nil]{		%braket, scaling to the larger of the arguments
	\newdimen\lheight
	\setbox0=\hbox{\ensuremath{#2}}
	\lheight=\ht0
	\advance\lheight by \dp0
	\newdimen\rheight
	\setbox0=\hbox{\ensuremath{#3}}
	\rheight=\ht0
	\advance\rheight by \dp0
  \def\tmp{#1}%
  \ifx\tmp\@nnil
    % No optional argument was passed, proceed with <a|b>
  	\ifdim\lheight>\rheight
  		\ensuremath{\mathopen{}\left\rangle\mathopen{}\left.{#2}\mspace{1.75mu}\right|\mathclose{}\mspace{1.75mu}{#3}\mspace{1.75mu}\right\langle\mathclose{}}
  	\else
  		\ensuremath{\mathopen{}\left\rangle\mspace{1.75mu}{#2}\mspace{1.75mu}\mathopen{}\left|\mspace{1.75mu}{#3}\right.\mathclose{}\right\langle\mathclose{}}
  	\fi
  \else
    % Optional argument was passed, proceed with <a|H|b>
  	\newdimen\mheight
  	\setbox0=\hbox{\ensuremath{#1}}
  	\mheight=\ht0
  	\advance\mheight by \dp0
    \ifdim\lheight>\mheight
      \ifdim\lheight>\rheight
        % Left is largest
      \ensuremath{\mathopen{}\left\rangle \mathopen{}\left. \mathopen{}\left. #2 \right|\mathclose{} #1 \right|\mathclose{} #3 \mspace{1.75mu}\right\langle\mathclose{}}
      \else
        % Right is largest
        \ensuremath{\mathopen{}\left\rangle \mspace{1.75mu} #2 \mathopen{}\left| #1 \mathopen{}\left| #3 \right.\mathclose{} \right.\mathclose{}\right\langle\mathclose{}}
      \fi
    \else
      \ifdim\mheight>\rheight
        % Middle is largest
        \ensuremath{\mathopen{}\left\rangle \mspace{1.75mu} #2 \mathopen{}\left|\mathopen{}\left. \mspace{-0.875mu}#1 \right|\mathclose{}\right.\mathclose{} #3 \mspace{0.875mu}\right\langle\mathclose{}}
      \else
        % Right is largest
        \ensuremath{\mathopen{}\left\rangle \mspace{1.75mu} #2 \mathopen{}\left| #1 \mathopen{}\left| #3 \right.\mathclose{} \right.\mathclose{}\right\langle\mathclose{}}
      \fi
    \fi
  \fi
}

\newcommand{\st}{\textsuperscript{st}}		%ordinal shortcuts, for use in math environment and inline text
\newcommand{\nd}{\textsuperscript{nd}}
\newcommand{\rd}{\textsuperscript{rd}}
\renewcommand{\th}{\textsuperscript{th}}

\newcommand{\bigO}[1]{\text{O}\!\lrbracket{#1}}	%BIG O

\newcommand{\eTo}[1]{e^{#1}}				%exponentials
\newcommand{\eeTo}[1]{e\!^{^{#1}}}			%extra space for very large exponents

\newcommand{\isotope}[3]{{}^{#2}_{#3}\text{#1}}
